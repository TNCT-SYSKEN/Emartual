<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8">
    <title>Neurnect Main</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <script src="https://cdn.rawgit.com/konvajs/konva/1.0.2/konva.min.js"></script>
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.1.0.min.js"></script>
  </head>
  <body>
    <nav class="navbar navbar-inverse">
      <div class="navbar-header">
        <a class="navbar-brand" href="/">Neurnect</a>
      </div>
    </nav>

    <a class="btn btn-primary center-block" id="reload" style="width: 200px; font-size: 40px;">ğŸ”ƒ</a>

    <div id="container"></div>
    <script type="text/javascript">
      var stage = new Konva.Stage({
          container: 'container',
          width: window.innerWidth,
          height: window.innerHeight
      });

      // add canvas element
      var layer = new Konva.Layer();
      stage.add(layer);

      // ã‚°ãƒ«ãƒ¼ãƒ—ã®ä½œæˆ
      var group = new Konva.Group({
        x: stage.getWidth() / 2,
        y: 200,
        draggable: true
      });

      // ã‚°ãƒ«ãƒ¼ãƒ—ã®ä½œæˆ
      var group2 = new Konva.Group({
        x: stage.getWidth() / 2,
        y: 600,
        draggable: true
      });

      // æ¥•å††ã®æç”»
      var oval = new Konva.Ellipse({
        x: 0,
        y: 0,
        radius: {
          x: 200,
          y: 100
        },
        stroke: 'blue',
        fill: 'lightblue',
        shadowColor: 'black',
        shadowBlur: 30,
        shadowOffset: 20,
        shadowOpacity: 0.75,
        stromeWidth: 4
      });
      var oval2 = new Konva.Ellipse({
        x: 0,
        y: 0,
        radius: {
          x: 200,
          y: 100
        },
        stroke: 'blue',
        fill: 'lightblue',
        shadowColor: 'black',
        shadowBlur: 30,
        shadowOffset: 20,
        shadowOpacity: 0.75,
        stromeWidth: 4
      });
      group.add(oval);
      group2.add(oval2);

      // EJSãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®ãƒ†ã‚­ã‚¹ãƒˆã®æç”»
      var text = new Konva.Text({
        x: 0,
        y: 0,
        text: '<%= text %>',
        fontSize: 30,
        fontFamily: 'Calibri',
        fill: 'green'
      });
      text.move({
        x: -(text.textWidth / 2),
        y: -(text.textHeight * text.textArr.length / 2)
      });

      var text2 = new Konva.Text({
        x: 0,
        y: 0,
        text: "ã‚\nã„\nã†\nãˆ\nãŠ\nã‹\nã\nã\nã‘\nã“\nã•\nã—\nã™\nã›\nã",
        fontSize: 30,
        align: 'center',
        fontFamily: 'Calibri',
        fill: 'green'
      });
      text2.move({
        x: -(text2.textWidth / 2),
        y: -(text2.textHeight * text2.textArr.length / 2)
      });

      oval.attrs.radiusX = text.textWidth / 2 + 95;
      oval.attrs.radiusY = text.textHeight * (text.textArr.length / 2 + 1) + 10;
      oval2.attrs.radiusX = text2.textWidth / 2 + 95;
      oval2.attrs.radiusY = text2.textHeight * (text2.textArr.length / 2 + 1) + 10;

      console.log(text.textWidth + ", " +text2.textHeight);

      group.add(text);
      group2.add(text2);

      layer.add(group);
      layer.add(group2);

      //MEMO: lineã‚’ã¤ãªãéš›ï¼Œovalã®ä¸­å¿ƒã¨ovalã®ä¸­å¿ƒã‚’ãƒ‘ã‚¹ã¨ã™ã‚‹lineã‚’æ›¸ãã¨ãã‚Œã£ã½ã„æ¥ç¶šã«ãªã‚Šãã†
      var line = new Konva.Line({
        points:  [group.attrs.x, group.attrs.y, group2.attrs.x, group2.attrs.y],
        stroke: 'blue',
        strokeWidth: 4,
        lineCap: 'round',
        lineJoin: 'round'
      });
      layer.add(line);
      line.moveToBottom();

      layer.draw();


      // OnClick
      $('#reload').click(function(){
        line.attrs.points = [group.attrs.x, group.attrs.y, group2.attrs.x, group2.attrs.y];
        layer.draw();
      });
    </script>
  </body>
</html>
